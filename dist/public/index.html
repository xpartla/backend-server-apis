<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>
<body class="container py-4">
<h1 class="mb-4">Spending Report</h1>
<form id="reportForm">
    <div class="mb-3">
        <label for="scope" class="form-label">Scope</label>
        <select id="scope" name="scope" class="form-select" required>
            <option value="">Select scope</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="yearly">Yearly</option>
        </select>
    </div>

    <div id="expenses" class="mb-3">

    </div>

    <button type="button" class="btn btn-secondary mb-3" onclick="addExpense()">Add Expense</button>
    <button type="submit" class="btn btn-primary mb-3">Submit</button>
</form>

<pre id="output" class="mt-4 bg-light p-3 rounded"></pre>

<script>
    let expenseIndex = 0;

    function addExpense() {
        const container = document.createElement('div');
        container.className = 'row g-2 mb-2 align-items-end';
        container.dataset.index = expenseIndex;

        container.innerHTML = `
                <div class="col-md-3">
                    <input type="text" name="item" class="form-control" placeholder="Item" required>
                </div>
                <div class="col-md-2">
                    <input type="number" name="quantity" class="form-control" placeholder="Qty" min="1" required>
                </div>
                <div class="col-md-2">
                    <input type="number" name="cost" class="form-control" placeholder="Cost" step="0.01" required>
                </div>
                <div class="col-md-3">
                    <select name="frequency" class="form-select" required>
                        <option value="">Frequency</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger w-100" onclick="this.closest('.row').remove()">Remove</button>
                </div>
            `;
        document.getElementById('expenses').appendChild(container);
        expenseIndex++;
    }

    document.getElementById('reportForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const scope = document.getElementById('scope').value;
        const expenses = Array.from(document.querySelectorAll('#expenses .row')).map(row => {
            return {
                item: row.querySelector('[name="item"]').value,
                quantity: parseFloat(row.querySelector('[name="quantity"]').value),
                cost: parseFloat(row.querySelector('[name="cost"]').value),
                frequency: row.querySelector('[name="frequency"]').value
            };
        });

        const response = await fetch('/report', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ scope, expenses })
        });

        const result = await response.json();
        document.getElementById('output').textContent = JSON.stringify(result, null, 2);
    });

    addExpense();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"/>

</body>

</html>
